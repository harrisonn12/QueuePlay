global
    log stdout format raw local0 info
    maxconn 4096
    
defaults
    log global
    mode http
    option httplog
    option dontlognull
    option log-health-checks
    retries 3
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    timeout check 5s

# HAProxy stats for API LB
stats enable
stats uri /api-stats
stats realm API\ Load\ Balancer
stats auth admin:api123

# API backend with health checks
backend api_backend
    mode http
    balance leastconn  # Best for API requests
    option httpchk GET /health
    
    # API servers with detailed health checks
    server api1 backend-api-1:8000 check inter 10s fall 3 rise 2 weight 100
    server api2 backend-api-2:8000 check inter 10s fall 3 rise 2 weight 100
    
    # API optimization
    option forwardfor
    option http-server-close
    option http-keep-alive

# Default frontend
frontend api_listener
    bind *:8000
    default_backend api_backend
